
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunamoth Traffic Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f7f6; color: #333; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { text-align: center; }
        .control-box { text-align: center; background: #e8f0fe; padding: 15px; border-radius: 8px; border: 1px solid #d2e3fc; }
        select { padding: 8px 15px; font-size: 16px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer; }
        .stat { text-align: center; font-size: 1.1em; font-weight: bold; color: #2e7d32; margin: 15px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        th { background-color: #f8f9fa; }
    </style>
</head>
<body>
    <h1>ğŸ“Š íŠ¸ë˜í”½ ëŒ€ì‹œë³´ë“œ</h1>
    
    <div class="card control-box">
        <label for="monthSelect">ğŸ“… <b>ì¡°íšŒí•  ì›”ì„ ì„ íƒí•˜ì„¸ìš”:</b> </label>
        <select id="monthSelect" onchange="updateDashboard()">
            <option value="">ë°ì´í„° ë¡œë”© ì¤‘...</option>
        </select>
    </div>

    <div class="card">
        <div class="stat" id="avgText">-</div>
        <canvas id="trafficChart"></canvas>
    </div>

    <div class="card">
        <h3>ğŸ“ ìƒì„¸ ë‚´ì—­</h3>
        <table id="trafficTable">
            <thead><tr><th>ë‚ ì§œ</th><th>íŠ¸ë˜í”½ (MB)</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div style="text-align:center; color:#999; font-size:12px;">Last Update: 2025-12-08 10:59:20</div>

    <script>
        const rawData = [{"date_str":"2025-12-08","mbytes":1329.79}]; 
        let myChart = null;

        function init() {
            const select = document.getElementById('monthSelect');
            
            if (!rawData || rawData.length === 0) {
                select.innerHTML = '<option>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</option>';
                return;
            }

            const months = new Set();
            rawData.forEach(d => months.add(d.date_str.substring(0, 7)));
            const sortedMonths = Array.from(months).sort().reverse();

            select.innerHTML = '';
            sortedMonths.forEach(m => {
                const opt = document.createElement('option');
                opt.value = m;
                opt.text = m;
                select.appendChild(opt);
            });

            if (sortedMonths.length > 0) {
                select.value = sortedMonths[0];
                updateDashboard();
            }
        }

        function updateDashboard() {
            const month = document.getElementById('monthSelect').value;
            const data = rawData.filter(d => d.date_str.startsWith(month));
            const chartData = [...data].sort((a,b) => a.date_str.localeCompare(b.date_str));

            let sum = 0;
            chartData.forEach(d => sum += d.mbytes);
            const avg = chartData.length ? (sum / chartData.length).toFixed(2) : 0;
            
            // ìë°”ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì‚¬ìš© (ì•ˆì „í•¨)
            document.getElementById('avgText').innerText = `ğŸ’¡ ${month} ì¼í‰ê· : ${avg} MB`;

            const tbody = document.querySelector('#trafficTable tbody');
            tbody.innerHTML = '';
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${row.date_str}</td><td>${row.mbytes} MB</td>`;
                tbody.appendChild(tr);
            });

            const ctx = document.getElementById('trafficChart').getContext('2d');
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => d.date_str.slice(8,10) + 'ì¼'),
                    datasets: [{
                        label: 'ì‚¬ìš©ëŸ‰ (MB)',
                        data: chartData.map(d => d.mbytes),
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: { responsive: true }
            });
        }

        init();
    </script>
</body>
</html>
